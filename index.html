<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>After School Classes Checkout</title>
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <!-- Link to external JavaScript file for vue -->
    <script src="./Javascript/vue.js" defer></script>
  </head>
  <body>
    <div id="lessonStore">
      <h1>{{ message }}</h1>

      <!-- This will display a search bar -->
      <input
        type="text"
        placeholder="Search lessons..."
        v-model="searchQuery"
        @input="searchLessons"
      />

      <!-- The following div will show a drop down menu to sort by Subject, Location, Price and space. -->
      <div>
        <label for="sortAttribute">Sort by:</label>
        <select v-model="sortAttribute" id="sortAttribute">
          <option value="subject">Subject</option>
          <option value="location">Location</option>
          <option value="price">Price</option>
          <option value="spaces">Spaces</option>
        </select>

        <!-- This is a toggle bottom that will switch from Ascending to descending-->
        <button @click="toggleSortOrder">
          Sort {{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }}
        </button>
      </div>

      <!-- This section will show the main page. I use v-bind styling because it is dynamic it can be change
       and no need for an external CSS file.  -->
      <section v-if="!showCheckoutForm">
        <h2>Available Lessons</h2>
        <div :style="{ display: 'flex', flexWrap: 'wrap', gap: '20px' }">
          <div
            v-for="lesson in sortedFilteredLessons"
            :key="lesson.id"
            :style="{ flex: '1 1 200px', maxWidth: '250px', border: '1px solid black', padding: '10px' }"
          >
            <figure>
              <img
                :src="lesson.image"
                alt="lesson image"
                :style="{ width: '100%', height: 'auto' }"
              />
              <h2>{{ lesson.subject }}</h2>
              <p>Location: {{ lesson.location }}</p>
              <p>Price: ${{ lesson.price }}</p>
              <p>Spaces Left: {{ lesson.spaces }}</p>
            </figure>
            <button @click="addToCart(lesson)" :disabled="lesson.spaces === 0">
              Add to Cart
            </button>
          </div>
        </div>

        <!-- If the cart is 0 the checkout button will not appear it must have at least 1 lesson in the cart -->
        <button v-if="cart.length > 0" @click="showCheckoutPage">
          Checkout ({{ cart.length }} items)
        </button>
      </section>

      <!-- This section will show the checkout form -->
      <section v-if="showCheckoutForm">
        <!-- This part will show a summary of your cart and if you want to remove the cart there will be a button-->
        <h2>Your Cart</h2>
        <div v-for="lesson in cart" :key="lesson.id" class="cart-item">
          <h3>{{ lesson.subject }}</h3>
          <p>Location: {{ lesson.location }}</p>
          <p>Price: ${{ lesson.price }}</p>
          <button @click="removeFromCart(lesson)">Remove from Cart</button>
        </div>

        <!-- This part will show a check out form to fill in your name, phone, address, etc,.. -->
        <h2>Checkout</h2>
        <p><strong>First Name:</strong> <input v-model="order.firstName" /></p>
        <p><strong>Phone Number:</strong> <input v-model="order.phone" /></p>
        <p><strong>Address:</strong> <input v-model="order.address" /></p>
        <p><strong>City:</strong> <input v-model="order.city" /></p>
        <p>
          <strong>State:</strong>
          <select v-model="order.state">
            <option disabled value="">Select State</option>
            <option>AL</option>
            <option>AR</option>
            <option>CA</option>
            <option>NV</option>
          </select>
        </p>
        <p><strong>Zip/Postal Code:</strong> <input v-model="order.zip" /></p>
        <p>
          <label
            ><input type="checkbox" v-model="order.gift" /> Ship As Gift?</label
          >
        </p>
        <p>
          <label>Deliver to address:</label>
          <label
            ><input type="radio" v-model="order.delivery" value="Home" />
            Home</label
          >
          <label
            ><input type="radio" v-model="order.delivery" value="Business" />
            Business</label
          >
        </p>
        <button @click="submitOrder" :disabled="!isCheckoutValid">
          Place Order
        </button>
        <button @click="backToMainPage">Back to Lessons</button>
      </section>

      <!-- This section will display the information as you type -->
      <section v-if="showCheckoutForm">
        <h2>Order Information</h2>
        <p><strong>First Name:</strong> {{ order.firstName }}</p>
        <p><strong>Phone:</strong> {{ order.phone }}</p>
        <p><strong>Address:</strong> {{ order.address }}</p>
        <p><strong>City:</strong> {{ order.city }}</p>
        <p><strong>State:</strong> {{ order.state }}</p>
        <p><strong>Zip:</strong> {{ order.zip }}</p>
        <p>
          <strong>Gift:</strong> <span v-if="order.gift">Sent as Gift</span>
          <span v-else>Not a Gift</span>
        </p>
        <p><strong>Delivery to:</strong> {{ order.delivery }}</p>
      </section>
    </div>
  </body>
</html>
