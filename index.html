<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>After School Classes Checkout</title>

    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <!-- CSS styling for the cart icon. right corner and small-->
    <style>
      .cart-icon {
        position: fixed;
        top: 20px;
        right: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        color: black;
      }

      .cart-badge {
        position: absolute;
        top: -10px;
        right: -10px;
        background-color: red;
        color: white;
        border-radius: 50%;
        padding: 5px 10px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="lessonStore">
      
      <!-- This section will show the main page. I use v-bind styling because it is dynamic it can be change
       and no need for an external CSS file. The search buttonshouls not appear on cart page -->
       <div v-if="!showCheckoutForm">
        <h1>{{ message }}</h1>

        <input
          type="text"
          placeholder="Search lessons..."
          v-model="searchQuery"
          @input="searchLessons" 
        />

        <!-- The following div will show a drop down menu to sort by Subject, Location, Price and space. -->
        <div>
          <label for="sortAttribute">Sort by:</label>
          <select v-model="sortAttribute" id="sortAttribute">
            <option value="subject">Subject</option>
            <option value="location">Location</option>
            <option value="price">Price</option>
            <option value="spaces">Spaces</option>
          </select>

          <!-- This is a toggle bottom that will switch from Ascending to descending-->
          <button @click="toggleSortOrder">
            Sort {{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }}
          </button>
        </div>
      </div>

      <!-- This section will show the main page. I use v-bind styling because it is dynamic it can be change
       and no need for an external CSS file.  -->
      <section v-if="!showCheckoutForm">
        <h2>Available Lessons</h2>
        <div :style="{ display: 'flex', flexWrap: 'wrap', gap: '20px' }">
          <div
            v-for="lesson in sortedFilteredLessons"
            :key="lesson.id"
            :style="{ flex: '1 1 200px', maxWidth: '250px', border: '1px solid black', padding: '10px' }"
          >
            <figure>
              <img
                :src="lesson.image"
                alt="lesson image"
                :style="{ width: '100%', height: 'auto' }"
              />
              <h2>{{ lesson.subject }}</h2>
              <p>Location: {{ lesson.location }}</p>
              <p>Price: ${{ lesson.price }}</p>
              <p>Spaces Left: {{ lesson.spaces }}</p>
            </figure>
            <button @click="addToCart(lesson)" :disabled="lesson.spaces === 0">
              Add to Cart
            </button>
          </div>
        </div>

        <!-- Shopping Cart Icon and Badge with Font Awesome -->
        <div v-if="cart.length > 0" @click="showCheckoutPage" class="cart-icon">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-badge">{{ cart.length }}</span>
        </div>
      </section>

      <!-- This section will show the checkout form -->
      <section v-if="showCheckoutForm">
        <!-- This part will show a summary of your cart and if you want to remove the cart there will be a button-->
        <h2>Your Cart</h2>
        <div v-for="lesson in cart" :key="lesson.id" class="cart-item">
          <h3>{{ lesson.subject }}</h3>
          <p>Location: {{ lesson.location }}</p>
          <p>Price: ${{ lesson.price }}</p>
          <button @click="removeFromCart(lesson)">Remove from Cart</button>
        </div>

        <!-- This part will show a check out form to fill in your name, phone, address, etc,.. -->
        <h2>Checkout</h2>
        <p><strong>First Name:</strong> <input v-model="order.firstName" /></p>
        <p><strong>Phone Number:</strong> <input v-model="order.phone" /></p>
        <p><strong>Address:</strong> <input v-model="order.address" /></p>
          <label>Deliver to address:</label>
          <label
            ><input type="radio" v-model="order.delivery" value="Home" />
            Home</label
          >
          <label
            ><input type="radio" v-model="order.delivery" value="Business" />
            Business</label
          >
        </p>
        <button @click="submitOrder" :disabled="!isCheckoutValid">
          Place Order
        </button>
        <button @click="backToMainPage">Back to Lessons</button>
      </section>

      <!-- This section will display the information as you type -->
      <section v-if="showCheckoutForm">
        <h2>Order Information</h2>
        <p><strong>First Name:</strong> {{ order.firstName }}</p>
        <p><strong>Phone:</strong> {{ order.phone }}</p>
        <p><strong>Address:</strong> {{ order.address }}</p>
        </p>
        <p><strong>Delivery to:</strong> {{ order.delivery }}</p>
      </section>
    </div>

    <!-- Vue.js Instance -->
    <script>
      new Vue({
        el: "#lessonStore",
        data: {
          message: "Welcome to After School Classes Checkout",
          showCheckoutForm: false, // Toggle for showing the checkout form
          cart: [], // Cart stores the lessons you add
          lessons: [
            {
              id: 1,
              subject: "Math",
              location: "Room 101",
              price: 50,
              spaces: 5,
              image: "./Images/Maths.jpeg",
            },
            {
              id: 2,
              subject: "Science",
              location: "Room 102",
              price: 60,
              spaces: 5,
              image: "./Images/Science.jpeg",
            },
            {
              id: 3,
              subject: "Art",
              location: "Room 103",
              price: 40,
              spaces: 5,
              image: "./Images/Art.jpeg",
            },
            {
              id: 4,
              subject: "Geography",
              location: "Room 104",
              price: 70,
              spaces: 5,
              image: "./Images/Geography.jpeg",
            },
            {
              id: 5,
              subject: "English",
              location: "Room 105",
              price: 100,
              spaces: 5,
              image: "./Images/English.jpeg",
            },
            {
              id: 6,
              subject: "Music",
              location: "Room 106",
              price: 500,
              spaces: 5,
              image: "./Images/Music.jpeg",
            },
            {
              id: 7,
              subject: "Economics",
              location: "Room 107",
              price: 20,
              spaces: 5,
              image: "./Images/Economics.jpeg",
            },
            {
              id: 8,
              subject: "Account",
              location: "Room 108",
              price: 68,
              spaces: 5,
              image: "./Images/Accounts.jpeg",
            },
            {
              id: 9,
              subject: "Physical Education",
              location: "Room 109",
              price: 100,
              spaces: 5,
              image: "./Images/PE.jpeg",
            },
            {
              id: 10,
              subject: "Literature",
              location: "Room 110",
              price: 100,
              spaces: 5,
              image: "./Images/Literature.jpeg",
            },
          ],
          sortAttribute: "subject", // The default sort attribute
          sortOrder: "asc", // Default sorting order ascending
          searchQuery: "", // Search input for lessons
          order: {
            firstName: "",
            phone: "",
            address: "",
            city: "",
            state: "",
            zip: "",
            gift: false,
            delivery: "",
          },
        },
        computed: {
                // Filters the lessons to match any attributes (subject, location, price, spaces) that include the search term.
          sortedFilteredLessons() {
            // Filter and sort lessons
            let filteredLessons = this.lessons.filter((lesson) => {
              let searchLower = this.searchQuery.toLowerCase(); // Convert search query to lowercase for case-insensitive search
              return (
                lesson.subject.toLowerCase().includes(searchLower) || // Search within subject
                lesson.location.toLowerCase().includes(searchLower) || // Search within location
                String(lesson.price).includes(searchLower) || // Search within price
                String(lesson.spaces).includes(searchLower) // Search within spaces
              );
            });

            // Sort the filtered lessons
            return filteredLessons.slice().sort((a, b) => {
              let comparison = 0;

              if (this.sortAttribute === "subject") {
                comparison = a.subject.localeCompare(b.subject);
              } else if (this.sortAttribute === "location") {
                comparison = a.location.localeCompare(b.location);
              } else if (this.sortAttribute === "price") {
                comparison = a.price - b.price;
              } else if (this.sortAttribute === "spaces") {
                comparison = a.spaces - b.spaces;
              }

              return this.sortOrder === "asc" ? comparison : -comparison;
            });
          },
          isCheckoutValid() {
            // Validate firstName and phone inputs
            const nameRegex = /^[a-zA-Z]+$/;
            const phoneRegex = /^[0-9]+$/;
            return (
              nameRegex.test(this.order.firstName) &&
              phoneRegex.test(this.order.phone)
            );
          },
        },
        methods: {
          // Methods to add to cart.
          addToCart(lesson) {
            if (lesson.spaces > 0) {
              this.cart.push(lesson);
              lesson.spaces--;
            }
          },
          // Methods to remove from cart
          removeFromCart(lesson) {
            const index = this.cart.indexOf(lesson);
            if (index > -1) {
              this.cart.splice(index, 1);
              lesson.spaces += 1;
            }
          },
          // Methods to enable toggling from ascending to descending
          toggleSortOrder() {
            this.sortOrder = this.sortOrder === "asc" ? "desc" : "asc";
          },
          // Method to show the checkout page
          showCheckoutPage() {
            // Go to checkout page
            this.showCheckoutForm = true;
          },
          // Method to return to main page
          backToMainPage() {
            this.showCheckoutForm = false;
          },
          // Method to submit order.
          submitOrder() {
            // First, check if the cart has at least one item
            if (this.cart.length === 0) {
              alert(
                "Your cart is empty! Please add at least one lesson to place an order."
              );
              return;
            }

            // Validate firstName and phone inputs
            if (this.isCheckoutValid) {
              alert("Order placed successfully!");
              this.resetOrder();
            } else {
              alert("Please provide valid Name and Phone Number.");
            }
          },
          resetOrder() {
            // Reset the order form and the cart
            this.order = {
              firstName: "",
              phone: "",
              address: "",
              city: "",
              state: "",
              zip: "",
              gift: false,
              delivery: "",
            };
            this.cart = [];
            this.lessons.forEach((lesson) => {
              lesson.spaces = 5;
            });
            this.showCheckoutForm = false;
          },
          // Remove any leading or trailing whitespace from the search query
          searchLessons() {
            this.searchQuery = this.searchQuery.trim();
          },
        },
      });
    </script>
  </body>
</html>
